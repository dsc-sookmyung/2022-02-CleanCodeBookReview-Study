# 클린코드

## 14. 점진적 개선

### 목차

1. 책의 예제
2. 점진적으로 개선하기
3. IDE를 활용해 점진적으로 개선하기

### 2. 점진적으로 개선하기

1. 뭔가 잘못되고 있다
   - 코드가 나빠지고 있음을 느낌
   - 기능을 추가하지 않고 개선을 시작
2. 테스트 코드를 작성한다
   - 변경을 한 후에도 시스템이 변경 전과 똑같이 돌아가야 함
   - 테스트 코드가 없다면 작성하자
   - 코드를 수정하기 전 상태에서 모든 테스트가 통과해야 한다
3. 점진적으로 개선한다
   - 책임에 따라 클라스를 나누고 코드를 옮긴다
   - 테스트가 깨지지 않도록 확인하며 자잘한 변경을 진행한다

**프로그램을 망치는 가장 좋은 방법 - 개선한다는 명목으로 구조를 크게 바꾸기**

### 3. IDE를 활용해 점진적으로 개선하기

- `Extract Method` : 메서드 추출기능
- `Change Signature` : 메소드 파라미터 추가, 삭제 및 변경
- `Rename` : 이름 변경
- `Extract Variable` : 변수 추출 기능
- `Extract Field` : 멤버 변수 추출 기능
- `Extract Constant` : 상수 추출 기능
- `Pull Members Up & Pull Members Down` : 하위 클래스의 메서드 → 상위로 올리기 & 상위 클래스의 매서드 → 하위로 내리기

## 15. JUnit 들여다보기 & 16. SerialData 리팩터링

라이브러리 분석을 통해 코ㄴ드를 바라보는 시각 기르기

### 목차

1. 책 내용 요약
2. 오픈 소스 접근법
3. Spring 프로젝트 접근법

### 1. 책 내용 요약

#### 15. JUnit 들여다보기

- 세상에 완벽한 코드는 없다
  - 의도를 명확하게 표현하기 위해 조건문을 메서드로 분리
  - 전후 단계가 잇는 변수들 사이 시간적인 결합(hidden temporal coupling)을 해결하기 위해 리팩터링
  - 더 저걸한 의미로 네이밍 변경
  - 불필요한 연산을 하는 코드 제거

#### 16. SerialData 리팩터링

- 남의 코드를 비판하고, 내 코드의 비판을 듣는 건 편안하게 여겨야 할 활동이다
- `Make it Work`

  - 테스트 코드가 모든 경우를 테스트하지 않는다 → 주석 처리된 테스트 코드들을 모두 동의하도록 손본다
  - 코드의 구조를 개선하기 전에 버그들을 수정한다. 경계 조건 오류 & 늘 거짓인 조건문.

- `Make it Right`
  - 옛날 스타일 코드 제거
  - 직접 변경하지 않아 생기는 버그보다 변경된 UID로 발생한 예외를 디버깅하는 게 낫다
    - serialVersionUID 컴파일러가 자동 생성하도록 함
  - 캡슐화를 위해 접근제한자를 수정 (`public` → `private`)
  - 사용되지 않는 변수 제거
  - 불필요한 주석 제거

### 2. 오픈 소스 접근법

[https://www.popit.kr/오픈소스-코드-분석-어떻게-하나](https://www.popit.kr/오픈소스-코드-분석-어떻게-하나)

- 해당 솔루션에 대한 기본 지식을 먼저 익혀라
  - 하둡을 분석하려면 → 구글에서 발표한 논문을 읽어라
  - HBase를 분석하려면 → BigTable 논문을 읽어라
  - 복잡한 분산 컴퓨팅 환경에서 운영되는 솔루션인 경우 더욱 더 그 시스템의 기본 개념과 아키텍처를 이해해야 한다.
- 본인 PC에 빌드 및 실행 환경을 구축하라
  - 단순 코드만 보면 특정 연산의 흐름이 어떻게 진행되고 있는지를 파악하기 어려운 경우가 많다
  - 개발자의 PC에 빌드와 실행 환경을 모두 구성하는 게 좋다.
- 수정, 실행, 확인 사이클을 짧게 만들어라
  - 분석에 필요한 정보를 출력하는 코드 & 확인을 위한 코드를 추가 → 기능을 실행해서 확인해야 하는 경우가 많다
  - 이 시간이 길어지면 효율이 떨어지고 많은 시간이 소요된다
  - 몇 번 반복하다 보면 같은 작업 패턴을 찾게 된다 → 스킙트를 만들어서 반복 작업을 효율적으로 하는 것이 좋다
- 자신에게 질문을 많이 하라
  - 특정 기능에 대해서 "나라면 어떻게 했을까" 라고 자신에게 질문을 던지고 머릿속에 어떻게 구현할 것인지 그려보자
- 분석하면서 문서로 정리하라
  - 분석을 하면서 그림 또는 문서로 정리하면 나중에 다시 보는 내게도 도움이 된다
- 디버거 활용하기
  - LOG level을 DEBUG로 설정하라
  - 디버거의 breakpoint 기능을 활용하라
  - `System.out.println`보다는 `Thread.dumpStack()`을 활용하라
- 코드의 일부를 통해 먼저 파악하기
  - 당장 관심있는 부분부터 집중적으로 파악하라
  - 테스트 코드는 좋은 교본이 된다
    - 일부는 데몬을 실행하지 않고 바로 실행, 확인할 수 있는 코드가 많다 → 이런 테스트 코드와 breakpoint 등을 잘 조합해서 쉽고 빠르게 분석할 수 있다.
  - 그래도 어려우면 초기 버전을 다운받아 분석하라

### 3. Spring 프로젝트 접근법

1. repository 이름과 README.md를 보고 프로젝트 성격을 파악한다
2. 패키지 구조를 살펴본다
3. 빌드 설정 파일을 보고 어떤 dependency를 쓰나 살펴본다
4. config 패키지 하위에 어떤 설정들이 되어있나 본다
5. `controller` 패키지 하위코드를 보고 어떤 요청들을 처리하는지 감을 잡는다
6. `service` 패키지 하위를 보고 비즈니스 로직을 추측한다
7. 데이터 구조를 알기 위해 `resource` 하위 DB 설정 파일을 보고 DB에 접근한다. `schema.sql` 파일이 있으면 DOL을 읽어본다
8. 세부적인 비즈니스 로직을 확인할 때는 테스트 코드와 비교하며 이해한다.
